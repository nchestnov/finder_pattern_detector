# Детектирование Finder Pattern-ов QR-кодов

### Запуск детектирования

`python3 main.py dataset`

где:
- **dataset** - название датасета, расположенного в директории `input/`, например, `TestSet1`

### Запуск микросервиса для валидации

`streamlit run checker/checker.py`

### Результаты

| Датасет |  Время работы, сек/изобр | Precision | Recall |  
| ------ | ------ | ----- | ------ |
| TestSet1 | 0.59 | 1.00 | 0.97 |
| TestSet2 | 0.70 | 1.00 | 0.95 |

### Идея

Finder Pattern - вложенные квадраты черного, белого и черного цвета. Поэтому будем искать несколько вложенных друг в друга контуров.

**Алгоритм:**
1. Преобразуем цветное изображение в оттенки серого, сгладим гауссианом
2. Выполним адаптивную бинаризацию
3. Пройдем медианным фильтром для подавления шумов после бинаризации
4. Выполним эрозию - компенсируем возможные дефекты бинаризации и исходного изображения
5. Найдем границы с помощью детектора Canny
6. Выполним дилацию найденных контуров - компенсируем возможные дефекты, возникшие при выделении границ, например, разорванные границы
7. Выполним иерархическое построение контуров - из найденных контуров оставим лишь те, которые имеют глубину вложенных потомков от 4 до 7 включительно - используем диапазон вместо точного значения для компенсации возможных ошибок при детектировании контуров, получим кандидаты в Finder Pattern-ы
8. Выполним фильтрацию кандидатов в Finder Pattern-ы - посмотрим на соотношения площадей контуров и их детей, аппроксимируем найденные контуры с помощью полигонов и посмотрим на соотношение их сторон, получим хорошие кандидаты в Finder Pattern-ы.
9. Выполним удаление "дубликатов" - возможна ситуация, когда и родительский, и дочерний контуры являются подходящими, оставляем только родительский, оставшиеся контуры и будут искомыми Finder Pattern-ами

